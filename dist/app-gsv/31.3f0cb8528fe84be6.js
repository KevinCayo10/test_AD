"use strict";(self.webpackChunkappGSV=self.webpackChunkappGSV||[]).push([[31],{1031:(L,d,s)=>{s.r(d),s.d(d,{PrestamosModule:()=>S});var p=s(6895),f=s(1667),h=s(5226),m=s.n(h),_=s(9849),t=s(4650),C=s(529);let b=(()=>{class r{constructor(o){this.http=o,this.url="/loans"}cargarPrestamos(){return this.http.get(this.url)}cargarPretamo(o){return this.http.get(`${this.url}/${o}`)}registrarPrestamo(o){return this.http.post(this.url,o)}actualizarPrestamo(o,e){return this.http.put(`${this.url}/${o}`,e)}eliminarPrestamo(o){return this.http.delete(`${this.url}/${o}`)}aprobarPrestamo(o,e){return this.http.put(`${this.url}/aprobar/${o}`,{id_usuario_presta_per:e})}rechazarPrestamo(o){return this.http.put(`${this.url}/rechazar/${o}`,{id_usuario_presta_per:"hola"})}devolverPrestamo(o,e){return this.http.put(`${this.url}/devolver/${o}`,{observaciones:e})}}return r.\u0275fac=function(o){return new(o||r)(t.LFG(C.eN))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var v=s(9828),T=s(7284),P=s(4841),E=s(6846),Z=s(9536),A=s(7653),l=s(433);let k=(()=>{class r{constructor(){this.titulo="",this.formularioEnviado=new t.vpe,this.formularioCerrado=new t.vpe}ngOnInit(){this.cargarFormulario()}cargarFormulario(){this.formulario=new l.cw({id_prestamo:new l.NI(this.data?.id_prestamo),observaciones:new l.NI(this.data?.observaciones,l.kI.required)})}grabar(){if(this.formulario.valid){const o=this.formulario.value;console.log(o),this.formularioEnviado.emit(o)}}cerrarFormulario(){this.formularioCerrado.emit()}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["gsv-form"]],inputs:{data:"data"},outputs:{formularioEnviado:"formularioEnviado",formularioCerrado:"formularioCerrado"},decls:20,vars:2,consts:[[1,"container","col-md-10"],[1,"card","custom-card"],[1,"card-body"],[1,"form-container",3,"formGroup","ngSubmit"],[1,"row"],[1,"col"],[1,"mb-3"],["for","observaciones",1,"form-label"],[1,"input-group"],["type","text","id","observaciones","formControlName","observaciones",1,"form-control"],[1,"input-group-text"],[1,"fas","fa-comment"],[1,"d-flex","justify-content-end"],["type","submit",1,"btn","btn-primary","me-2",3,"disabled"],[1,"fas","fa-save"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fas","fa-times"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),t.NdJ("ngSubmit",function(){return e.grabar()}),t.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"label",7),t._uU(8,"Observaciones"),t.qZA(),t.TgZ(9,"div",8),t._UZ(10,"input",9),t.TgZ(11,"span",10),t._UZ(12,"i",11),t.qZA()()()()(),t.TgZ(13,"div",12)(14,"button",13),t._UZ(15,"i",14),t._uU(16," Grabar "),t.qZA(),t.TgZ(17,"button",15),t.NdJ("click",function(){return e.cerrarFormulario()}),t._UZ(18,"i",16),t._uU(19," Cancelar "),t.qZA()()()()()()),2&o&&(t.xp6(3),t.Q6J("formGroup",e.formulario),t.xp6(11),t.Q6J("disabled",e.formulario.invalid))},dependencies:[l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u]}),r})();var g=s(7155),x=s(8072),y=s(7620);function w(r,n){if(1&r&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&r){const o=n.$implicit;t.xp6(1),t.Oqu(o.title)}}function F(r,n){if(1&r&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&r){const o=n.$implicit,e=t.oxw().$implicit;t.xp6(1),t.Oqu(e[o.field])}}function J(r,n){if(1&r){const o=t.EpF();t.TgZ(0,"tr"),t.YNc(1,F,2,1,"td",2),t.TgZ(2,"td")(3,"div",3)(4,"button",4),t.NdJ("click",function(){const a=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.accionAprobar(a))}),t._UZ(5,"i",5),t.TgZ(6,"span",6),t._uU(7,"Aprobar"),t.qZA()(),t.TgZ(8,"button",7),t.NdJ("click",function(){const a=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.accionRechazar(a))}),t._UZ(9,"i",8),t.TgZ(10,"span",6),t._uU(11,"Rechazar"),t.qZA()(),t.TgZ(12,"button",9),t.NdJ("click",function(){const a=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.accionEditar(a))}),t.TgZ(13,"span",6),t._uU(14,"Devolver"),t.qZA(),t._UZ(15,"i",10),t.qZA(),t.TgZ(16,"button",11),t.NdJ("click",function(){const a=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.accionEliminar(a.id_prestamo))}),t._UZ(17,"i",12),t.TgZ(18,"span",6),t._uU(19,"Eliminar"),t.qZA()()()()()}if(2&r){const o=n.$implicit,e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.metaDataColumns),t.xp6(3),t.Q6J("disabled","PENDIENTE"!==o.estado),t.xp6(4),t.Q6J("disabled","PENDIENTE"!==o.estado),t.xp6(4),t.Q6J("disabled","DEVUELTO"!==o.estado)}}let N=(()=>{class r{constructor(o,e){this.serviceEquipo=o,this.serviceUsuario=e,this.onClick=new t.vpe,this.onClickEliminar=new t.vpe,this.onClickAprobar=new t.vpe,this.onClickRechazar=new t.vpe,this.columns=[]}ngOnChanges(o){o.metaDataColumns&&(this.columns=this.metaDataColumns.map(e=>e.field))}crearNuevaData(){this.data.forEach(o=>{const e=this.serviceEquipo.cargarEquipo(o.id_equipo_per).subscribe(u=>u.nombre),i=this.usuarios.find(u=>u.id_usuario===o.id_usuario_presta_per),a=`${i.nombre} ${i.apellido}`,c=this.usuarios.find(u=>u.id_usuario===o.id_usuario_solicita_per);this.newData.push({id_prestamo:o.id_prestamo,id_equipo_per:e,fecha_prestamo:o.fecha_prestamo,fecha_devolucion:o.fecha_devolucion,id_usuario_presta_per:a,id_usuario_solicita_per:`${c.nombre} ${c.apellido}`,observaciones:o.observaciones,estado:o.estado}),console.log(this.newData)})}accionEditar(o){this.onClick.emit(o)}accionAprobar(o){this.onClickAprobar.emit(o)}accionRechazar(o){this.onClickRechazar.emit(o)}accionEliminar(o){m().fire({title:"\xbfEst\xe1 seguro que desea eliminar este elemento?",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&this.onClickEliminar.emit(o)})}mensaje(o){m().fire({title:o,icon:"info",timer:3e3,showConfirmButton:!1})}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(x.A),t.Y36(y.i))},r.\u0275cmp=t.Xpm({type:r,selectors:[["gsv-table-prestamos"]],contentQueries:function(o,e,i){if(1&o&&t.Suo(i,g.w1,5),2&o){let a;t.iGM(a=t.CRH())&&(e.columnsDef=a)}},viewQuery:function(o,e){if(1&o&&t.Gf(g.BZ,7),2&o){let i;t.iGM(i=t.CRH())&&(e.table=i.first)}},inputs:{data:"data",metaDataColumns:"metaDataColumns",title:"title"},outputs:{onClick:"onClick",onClickEliminar:"onClickEliminar",onClickAprobar:"onClickAprobar",onClickRechazar:"onClickRechazar"},features:[t.TTD],decls:7,vars:2,consts:[[1,"container"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"btn-group"],[1,"btn","btn-success",3,"disabled","click"],[1,"fa-solid","fa-file-circle-check"],[1,"btn-tooltip"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"fa-solid","fa-file-circle-xmark"],[1,"btn","btn-warning",3,"disabled","click"],[1,"fa","fa-pencil"],[1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"table",1)(2,"thead")(3,"tr"),t.YNc(4,w,2,1,"th",2),t.qZA()(),t.TgZ(5,"tbody"),t.YNc(6,J,20,4,"tr",2),t.qZA()()()),2&o&&(t.xp6(4),t.Q6J("ngForOf",e.metaDataColumns),t.xp6(2),t.Q6J("ngForOf",e.data))},dependencies:[p.sg],styles:[".btn-tooltip[_ngcontent-%COMP%]{visibility:hidden;background-color:#000000bf;color:#fff;text-align:center;padding:5px;border-radius:4px;position:absolute;z-index:1;bottom:125%;left:50%;transform:translate(-50%);white-space:nowrap}.btn[_ngcontent-%COMP%]:hover   .btn-tooltip[_ngcontent-%COMP%]{visibility:visible}"]}),r})();function z(r,n){if(1&r){const o=t.EpF();t.TgZ(0,"gsv-search",5),t.NdJ("buscadorEnviado",function(i){t.CHM(o);const a=t.oxw();return t.KtG(a.buscarData(i))}),t.qZA()}}function M(r,n){if(1&r){const o=t.EpF();t.TgZ(0,"gsv-form",6),t.NdJ("formularioEnviado",function(i){t.CHM(o);const a=t.oxw();return t.KtG(a.grabarFormulario(i))})("formularioCerrado",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.cerrarFormulario())}),t.qZA()}if(2&r){const o=t.oxw();t.Q6J("data",o.fila)}}const O=[{path:"",component:(()=>{class r{constructor(o){this.prestamoService=o,this.registros=[{_id:1,nombresCompletos:"Juan P\xe9rez",correoElectronico:"juan.perez@mail.com",direccion:"Av. Quito",celular:"0991234567"}],this.title="PRESTAMOS",this.metaDataColumns=[{field:"id_prestamo",title:"ID"},{field:"id_equipo_per",title:"ID EQUIPO"},{field:"fecha_prestamo",title:"FECHA DEL PRESTAMO"},{field:"fecha_devolucion",title:"FECHA DE DEVOLUCION"},{field:"id_usuario_presta_per",title:"TECNICO"},{field:"id_usuario_solicita_per",title:"USUARIO"},{field:"observaciones",title:"OBSERVACION"},{field:"estado",title:"ESTADO"}],this.keypadButtons=[{icon:"fa-solid fa-cloud-arrow-down",color:"btn-success",accion:"download"},{icon:"fa-solid fa-plus",color:"btn-primary",accion:"NUEVO"}],this.data=[],this.totalRegistros=this.data.length,this.cargarClientes("")}cargarClientes(o){this.prestamoService.cargarPrestamos().subscribe(e=>{this.registros=e,o&&(console.log(o),this.registros=this.registros.filter(i=>i.nombresCompletos.toLowerCase().includes(o.toLowerCase())),console.log(this.registros)),this.totalRegistros=this.registros.length,this.changePage(0)})}changePage(o){const e=_.N.PAGE_SIZE,i=e*o;this.data=this.registros.slice(i,i+e)}enviarAccion(o){switch(o){case"DOWNLOAD":break;case"NUEVO":this.formulario=!0,this.abrirFormulario()}}accionEditar(o){this.formulario=!0,this.abrirFormulario(o)}accionEliminar(o){console.log("Entro a pagelis"),this.prestamoService.eliminarPrestamo(o).subscribe(()=>{this.cargarClientes("")})}accionAprobar(o){console.log(o),this.prestamoService.aprobarPrestamo(o.id_prestamo,"3").subscribe(e=>{this.mostrarMensaje("Prestamo aprobado"),this.cargarClientes("")})}accionRechazar(o){this.prestamoService.rechazarPrestamo(o.id_prestamo).subscribe(e=>{this.mostrarMensaje("Prestamo rechazado"),this.cargarClientes("")})}buscarData(o){console.log(o),this.cargarClientes(o.terminoBusqueda)}grabarFormulario(o){if(o)if(o.id_prestamo){const e={...o};console.log("Entro al ID"),console.log(e),this.prestamoService.devolverPrestamo(o.id_prestamo,e.observaciones).subscribe(()=>{this.cargarClientes(""),this.formulario=!1,this.mostrarMensajeActualizacion()})}else{const e={...o};this.prestamoService.registrarPrestamo(e).subscribe(()=>{console.log("Dentro regsitrar"),console.log(e),this.cargarClientes(""),this.formulario=!1,this.mostrarMensajeA\u00f1adir()})}else this.formulario=!1}abrirFormulario(o=null){this.fila=o}cerrarFormulario(){this.formulario=!1}mostrarMensajeActualizacion(){m().fire({title:"Registro actulaizado",icon:"info",timer:3e3,showConfirmButton:!1})}mostrarMensajeA\u00f1adir(){m().fire({title:"Registro a\xf1adido",icon:"info",timer:3e3,showConfirmButton:!1})}mostrarMensaje(o){m().fire({title:o,icon:"info",timer:3e3,showConfirmButton:!1})}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(b))},r.\u0275cmp=t.Xpm({type:r,selectors:[["gsv-page-list"]],decls:9,vars:7,consts:[[3,"buscadorEnviado",4,"ngIf"],[3,"data","formularioEnviado","formularioCerrado",4,"ngIf"],[3,"data","metaDataColumns","title","onClick","onClickEliminar","onClickAprobar","onClickRechazar"],[3,"length","onChangePage"],[3,"keypadButtons","onClick"],[3,"buscadorEnviado"],[3,"data","formularioEnviado","formularioCerrado"]],template:function(o,e){1&o&&(t.TgZ(0,"div"),t._UZ(1,"gsv-title"),t.YNc(2,z,1,0,"gsv-search",0),t.qZA(),t.YNc(3,M,1,1,"gsv-form",1),t.TgZ(4,"gsv-container")(5,"perfect-scrollbar")(6,"gsv-table-prestamos",2),t.NdJ("onClick",function(a){return e.accionEditar(a)})("onClickEliminar",function(a){return e.accionEliminar(a)})("onClickAprobar",function(a){return e.accionAprobar(a)})("onClickRechazar",function(a){return e.accionRechazar(a)}),t.qZA()(),t.TgZ(7,"gsv-paginator",3),t.NdJ("onChangePage",function(a){return e.changePage(a)}),t.qZA()(),t.TgZ(8,"gsv-keypad-button",4),t.NdJ("onClick",function(a){return e.enviarAccion(a)}),t.qZA()),2&o&&(t.xp6(2),t.Q6J("ngIf",!e.formulario),t.xp6(1),t.Q6J("ngIf",e.formulario),t.xp6(3),t.Q6J("data",e.data)("metaDataColumns",e.metaDataColumns)("title",e.title),t.xp6(1),t.Q6J("length",e.totalRegistros),t.xp6(1),t.Q6J("keypadButtons",e.keypadButtons))},dependencies:[p.O5,v.r,T.e,P.Vv,E.J,Z.o,A.g,k,N]}),r})()}];let D=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[f.Bz.forChild(O),f.Bz]}),r})();var R=s(8366);let S=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[p.ez,D,R.m]}),r})()}}]);